<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>摄影情况信息</title> <@p.cache/> <@p.css/> <@p.js/>
<script src="/res/js/ajaxfileupload.js"></script>
<style>
.chia-file-up {
	padding: 0px 0px;
}

.chia-file-up, select {
	border: 0px solid #d5d5d5;
}
</style>
</head>
<body>
	<@p.top/>
	<div class="main-container" id="main-container">
		<div class="main-container-inner">
			<@p.left/>
			<div class="main-content">
				<div class="breadcrumbs" id="breadcrumbs">
					<ul class="breadcrumb">
						<li><i class="icon-home home-icon"> </i> <a href="#">
								Home </a></li>
						<li><a href="#"> Tables </a></li>
						<li class="active">员工信息</li>
					</ul>
					<!-- .breadcrumb -->
					<div class="nav-search" id="nav-search"></div>
					<!-- #nav-search -->
				</div>

				<!-- /.col-lg-6 -->
				<div class="col-md-12">
					<form enctype="multipart/form-data" role="form" action=""
						id="form-anyVal" method="post">
						<div id="val-input-empty" class="col-md-12">
							<div class="col-md-2">
								<label for="waved">工号</label> <input type="text" name="wave"
									id="waved" />
							</div>
							<div class="col-md-2">
								<label for="productNamed">员工姓名</label> <input type="text"
									name="productName" id="productNamed" />
							</div>
							<div class="col-md-2">
								<span class="input-group-btn">
									<button id="queryPhotographyInfo" class="btn btn-default"
										type="button">查询</button>
								</span>
							</div>
							<div class="col-md-2">
								<button id="add_button" class="btn btn-primary btn-lg"
									data-toggle="modal" data-target="#addUserInfoEntity">添加
								</button>
							</div>
						</div>
						<div>
							<input hidden="hidden" type="text" id="pageNow" name="pageNow"
								value=""> <input hidden="hidden" type="text"
								id="pageSize" name="pageSize" value="">
						</div>

					</form>


				</div>
				<div class="page-content">
					<div class="col-xs-12">
						<div class="tabbable">
							<table class="table  table-bordered">
								<thead>
									<tr>
										<th colspan="30" style="text-align: center; font-size: 16px;">详细信息</th>
									</tr>
									<tr>
										<th>ID</th>
										<th>工号</th>
										<th>姓名</th>
										<th>性别</th>
										<th>入职时间</th>
										<th>工龄(天数)</th>
										<th>备注/图片</th>
										<th>创建时间</th>
										<th>操作</th>
									</tr>
								</thead>
								<tbody class="table_app">
								</tbody>
							</table>
							<ul class="pager pagination-lg tcdPageCode">
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 修改模态框update_acces_info_form -->
	<div class="modal fade" id="myModal1" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<form action="" id="update_acces_info_form" method="post">
						<input type="hidden" name="id" id="id" />
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel">修改信息</h4>
				</div>
				<div class="modal-body">
					
						<div class="col-md-12">
							<!-- <div class="col-md-6">
								<label for="employeeNo">工号</label> <input type="text"
									class="form-control" name="employeeNo" placeholder=""
									id="employeeNo">
							</div> -->
							<div class="col-md-6">
								<label for="name">姓名</label> <input type="text"
									class="form-control" name="name" placeholder="" id="name">
							</div>
							<div class="col-md-6">
								<label for="sex">性别</label> <input type="text"
									class="form-control" name="sex" placeholder="" id="sex">
							</div>
							<div class="col-md-6">
								<label for="hiredate">入职时间</label> <input type="text"
									class="form-control input-date" name="hiredate" placeholder=""
									id="hiredate">
							</div>
							<!-- <div class="col-md-6">
								<label for="workage">工龄</label> <input type="text"
									class="form-control" name="workage" placeholder="" id="workage">
							</div> -->
							<div class="col-md-6">
								<label for="note">备注/图片</label> <input type="file"
									class="form-control chia-file-up" name="note"  id="note">
							</div>
							 <input hidden="hidden" id="id" type="text" value=""
                               name="id">
							<!-- <div class="col-md-6">
									<label for="createTime">修改时间</label> <input type="text"
										class="form-control" name="createTime" placeholder="" id="createTime">
								</div> -->

						</div>
					
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button class="btn btn-primary" data-dismiss="modal" id="myupdates">修改</button>
				</div>
			</div>
			</form>
		</div>
	</div>
	<!-- 添加模态框 add_userInfoEntity_form -->
	<div class="modal fade" id="addUserInfoEntity" tabindex="-1"
		role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">

			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel">添加信息</h4>
				</div>
				<div class="modal-body">
					<form action="" id="add_userInfoEntity_form" method="post">
						<input type="hidden" name="id" id="id" />
						<div class="col-md-12">
							<!-- <div class="col-md-6">
								<label for="employeeNo">工号</label> <input type="text"
									class="form-control" name="employeeNo" placeholder=""
									id="employeeNo">
							</div> -->
							<div class="col-md-6">
								<label for="name">姓名</label> <input type="text"
									class="form-control" name="name" placeholder="" id="name">
							</div>
							<div class="col-md-6">
								<label for="sex">性别</label> <input type="text"
									class="form-control" name="sex" placeholder="" id="sex">
							</div>
							<div class="col-md-6">
								<label for="hiredate">入职时间</label> <input type="text"
									class="form-control input-date" name="hiredate" placeholder=""
									id="hiredate">
							</div>
							<!-- <div class="col-md-6">
								<label for="workage">工龄</label> <input type="text"
									class="form-control" name="workage" placeholder="" id="workage">
							</div> -->
							<div class="col-md-6">
								<label for="note">备注/图片</label> <input type="file"
									class="form-control chia-file-up" name="note"  id="note">
							</div>
							

						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button class="btn btn-primary" data-dismiss="modal" id="add">添加</button>
				</div>
			</div>

		</div>
	</div>
</body>
<script type="text/javascript">





/**
 * Created by admin on 2017/4/28.
 */
//页面加载就执行

$(function () {

    $(".col-md-2").find(":input").each(
        function () {
            $(this).val("");
        });
    var anyVal = $("#form-anyVal").serialize();
    
    getPhotographyInfoBpcnt(anyVal);

   
    //查询
    $("#queryPhotographyInfo").on("click", function () {
        var anyVal = $("#form-anyVal").serialize();
        getPhotographyInfoBpcnt(anyVal);
    });
    
	$("#ajaxAddPhotographyInfo").on("click", function () {
		
	var formData = new FormData($("#add_photography_info_form")[0]);

  
   }); 
});

//查询总条数
function getPhotographyInfoBpcnt(anyVal) {

    $.post('userInfo/findCount.do', anyVal,
        function (data) {
    		
            $("#pageSize").val(10); //默認查 10條數據这里啊 默认值是10
            $("#pageNow").val(data.pageNow);
         	
            var anyVal2 = $("#form-anyVal").serialize();
            //获取form参数进行查询
            //調用方法传参
            findPhotographyInfo(anyVal2);
         
            // 进入后台进行分页查询
            $(".tcdPageCode").createPage({ //哦哦
                pageCount: data.totalPageCount, //总页数
                current: data.pageNow, //当前页
                backFn: function (p) {
                    $("#pageSize").val(10);
                    $("#pageNow").val(p); //給當前頁賦值
                    var anyVal1 = $("#form-anyVal").serialize(); //获取form表单
                    //調用方法
                    findPhotographyInfo(anyVal1);
                }
            });
        });
}
//查询
function findPhotographyInfo(anyVal) {
    $.post("userInfo/findAll.do", anyVal, //from表单内容
        function (data) {
            $(".table_app").empty(); //清空原有的数据
            for (var i = 0; i < data.length; i++) {
                var _HTML_TEBLE_ = "";
                _HTML_TEBLE_ = "<tr>" +"<input type='hidden' class='id' value='"
                    + data[i].id
                    + "'/>"
                    + "<td>"
                    + data[i].id
                    + "</td><td >"
                        //序列号
                    + (data[i].employeeNo == null ? '' : data[i].employeeNo)
                    + "</td><td >"
                        //波次号
                    + (data[i].name == null ? '' : data[i].name)
                    + "</td><td >"
                        //商品名称
                    + (data[i].sex == null ? '' : data[i].sex)
                    + "</td><td >"
                        //商品编码
                    + (data[i].hiredate == null ? '' : data[i].hiredate)
                    + "</td><td>"
                    
                    + (data[i].workage == null ? '' : data[i].workage)
                   
                 
                    +"</td><td>"
                    //图片
                    + "<img  width='50px' height='40px'src='"
                    + (data[i].note == null ? '' : data[i].note)
                    + "'/>"
                    + "</td><td>"
                        //创建时间
                    + (data[i].createTime == null ? '' : data[i].createTime)
                    + "</td><td  class='dataStatus" +"'><button type='button'  data-toggle='modal' data-target='#myModal1' onclick='confirmShipment(\""
		                    + data[i].id
		                    + "\")' class='btn btn-primary btn-sm icon-confirm'>修改</button></td></tr>";
                $(".table_app").append(_HTML_TEBLE_);
                confirmShipment(data[i].id)
                 
            }
           
        });
    
}
//进入修改
function confirmShipment(id) {
	
    console.log(id);
    argArr = {id: id};
   
    $.ajax({
		url : 'userInfo/findById.do',
		datatype : 'json',
		type : 'post',
		data : {
			id : id
		},
		success : function(data) {
			var record = eval(data);
			$("#id").val(record.id);
			$("#employeeNo").val(record.employeeNo);
			$("#name").val(record.name);
			$("#sex").val(record.sex);
			$("#hiredate").val(record.hiredate);
			$("#workage").val(record.workage);
			$("#note").val(record.note);
			$("#createTime").val(record.createTime);
			
		}

	});
}
//提交修改
 $("#myupdates").on("click", function () {
    var formData = new FormData($("#update_acces_info_form")[0]);

    $.ajax({
		url : 'userInfo/update.do',
		datatype : 'json',
		type : 'post',
		data : 
			/* {id:id,employeeNo:employeeNo,name:name,sex:sex,hiredate:hiredate,workage:workage,note:note} */
			formData,
			async : true,
	        cache : true,
	        contentType : false,
	        processData : false,
		success : function(data) {
		//修改成功后再次刷新页面
			 var pageNow = $("#pageNow").val();
	            $("#pageSize").val(10);
	            $("#pageNow").val(pageNow);//給當前頁賦值
	            var anyVal = $("#form-anyVal").serialize();//获取form表单
	            //調用方法
	           findPhotographyInfo(anyVal); 
	      
				
		}
    })
});

//添加
$("#add").on("click", function () {
		 var formData = new FormData($("#add_userInfoEntity_form")[0]);
		
 $.ajax({
     url : 'userInfo/add.do',
     type : 'POST',
     data : formData,
     async : false,
     cache : false,
     contentType : false,
     processData : false,
     success : function(data) {
    	 
    	 //添加成功后再次刷新页面,此时返回首页
		 //var pageNow = $("#pageNow").val();
            $("#pageSize").val(10);
            $("#pageNow").val(1);//給當前頁賦值
            var anyVal = $("#form-anyVal").serialize();//获取form表单
            //調用方法
           findPhotographyInfo(anyVal); 
     },
     error : function() {
         alert("添加失败!");
     }
	});
});
</script>
<script type="text/javascript" src="/res/js/input-date.js"></script>
</html>