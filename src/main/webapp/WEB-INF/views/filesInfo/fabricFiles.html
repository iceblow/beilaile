<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8" />
<title>面料档案</title><@p.cache/><@p.css/> <@p.js/>
</head>

<body>
	<@p.top/>
	<div class="main-container" id="main-container">
		<script type="text/javascript">
			try {
				ace.settings.check('main-container', 'fixed')
			} catch (e) {
			}
		</script>
		<div class="main-container-inner">
			<@p.left/>
			<div class="main-content">
				<div class="breadcrumbs" id="breadcrumbs">
					<script type="text/javascript">
						try {
							ace.settings.check('breadcrumbs', 'fixed')
						} catch (e) {
						}
					</script>
					<ul class="breadcrumb">
						<li><i class="icon-home home-icon"> </i> <a href="#">
								Home </a></li>
						<li><a href="#"> Tables </a></li>
						<li class="active">面料档案</li>
					</ul>
					<!-- .breadcrumb -->
					<div class="nav-search" id="nav-search"></div>
					<!-- #nav-search -->
				</div>
				<div class="col-md-12">
					<button id="add_button" class="btn btn-primary btn-lg"
						data-toggle="modal" data-target="#myModal">添加新面料</button>
				</div>
				<div class="col-md-12">
					<form enctype="multipart/form-data" action="" id="form-anyVal">
						<div class="col-md-8">
							<div class="col-md-4">
								<label for="fabricCode">面料编号</label> <input type="text"
									class="form-control" name="fabricCode" placeholder="">
							</div>
							<div class="col-md-4">
								<label for="fabricName">面料名称</label> <input type="text"
									class="form-control" name="fabricName" placeholder="">
							</div>
							<div class="col-md-4">
								<label for="supplierCode">供应商编号</label> <input type="text"
									class="form-control" name="supplierCode"
									id="input-supplierCode" placeholder=" ">
							</div>
							<div class="col-md-4">
								<label for="supplierName">供应商名称</label> <input type="text"
									class="form-control" name="supplierName" placeholder=" ">
							</div>
							<div class="col-md-4">
								<label for="colorCardCode">色卡编号</label> <input type="text"
									class="form-control" name="colorCardCode"
									id="input-colorCardCode">
							</div>
							<div class="col-md-4">
								<label for="colorCardNmae">色卡名称</label> <input type="text"
									class="form-control" name="colorCardNmae">
							</div>
							<div class="col-md-4">
								<label for="colorName">颜色名称</label> <input type="text"
									class="form-control" name="colorName" placeholder=" ">
							</div>
							<div class="col-md-4">
								<label for="colorCode">颜色编号</label> <input type="text"
									class="form-control" name="colorCode" placeholder=" ">
							</div>
							<div class="col-md-4">
								<label for="fabricOrigin">面料产地</label> <input type="text"
									class="form-control" name="fabricOrigin">
							</div>
							<div class="col-md-4">
								<label for="fabricType">面料类型 </label> <input type="text"
									class="form-control" name="fabricType" placeholder=" ">
							</div>
						</div>
						<div>
							<input hidden="hidden" type="text" id="pageNow" name="pageNow"
								value=""> <input hidden="hidden" type="text"
								id="pageSize" name="pageSize" value="">
						</div>
						<div class="col-md-2">
							<span class="input-group-btn">
								<button id="anyVal-btn" class="btn btn-default" type="button">
									查询</button>
							</span>
						</div>
					</form>
				</div>
				<!-- /.col-lg-6 -->
				<div class="col-md-12" style="height: 50px;"></div>
				<div class="page-content">
					<div class="col-xs-12">
						<div class="tabbable">
							<table class="table table-bordered">
								<thead>
									<tr>
										<!-- <th>序号</th>
										<th>面料名称</th> -->
										<!-- 	<th>供应商编号</th> -->
										<th>面料编号</th>
										<th>供应商名称</th>
										<!-- <th>色卡编号</th> -->
										<th>色卡名称</th>
										<th>颜色编号</th>
										<th>颜色名称</th>
										<th>面料单价</th>
										<th>面料门幅</th>
										<th>单条/米数</th>
										<th>面料产地</th>
										<th>面料成分</th>
										<th>面料克重</th>
										<th>公斤米数</th>
										<th>面料类型</th>
										<th>面料图样</th>
										<th>色卡更新日期</th>
										<th>添加</th>
										<th>操作</th>
									</tr>
								</thead>
								<tbody class="table_app">
								</tbody>
							</table>
							<ul class="pager pagination-lg tcdPageCode">
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--添加/修改 模态框（Modal） -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"
							aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="myModalLabel">修改 /添加颜色</h4>
					</div>
					<form enctype="" role="" id="addOrUpdateFabricLibrary" action=""
						method="">
						<div class="modal-body" id="modify-prompt">
							<div id="val-input-empty" class="col-md-12">
								<!-- <div class="col-md-4">
									<label for="fabricName">面料名称</label> <input type="text"
										class="form-control" name="fabricName" id="fabricName"
										placeholder="">
								</div> -->
								<div class="col-md-4">
									<label for="supplierCode">供应商编号</label> <input
										readonly="readonly" type="text" class="form-control"
										name="supplierCode" id="supplierCode" placeholder="">
								</div>
								<div class="col-md-4">
									<label for="colorCardCode">色卡编号</label> <input
										readonly="readonly" type="text" class="form-control"
										name="colorCardCode" id="colorCardCode" placeholder="">
								</div>
								<!-- <div class="col-md-4">
									<label for="supplierCode">供应商名称</label> <select
										class="form-control" name="supplierCode"
										id="selectlink-supplier">
									</select>
								</div>
								<div class="col-md-4">
									<label for="colorCardCode">色卡名称</label> <select
										class="form-control" name="colorCardCode"
										id="select-ColorCardCode">
									</select>
								</div> -->

								<div class="col-md-4">
									<label for="colorCode">颜色编号</label> <input type="text"
										class="form-control colorLength" onkeyup="chkNum(this)"
										name="colorCode" id="colorCode">
								</div>

								<div class="col-md-4">
									<label for="colorName">颜色名称</label> <input type="text"
										class="form-control" name="colorName" id="colorName"
										placeholder=" ">
								</div>
								<div class="col-md-4">
									<label for="fabricPrice">面料单价</label> <input type="text"
										class="form-control" onkeyup="chkNum(this)" name="fabricPrice"
										id="fabricPrice" placeholder=" ">
								</div>
								<!-- <div class="col-md-4">
									<label for="fabricLength">色卡门幅</label> <input type="text"
										class="form-control" name="fabricLength" id="fabricLength"
										placeholder="">
								</div> -->
								<div class="col-md-4">
									<label for="fabricMeter">单条/米数</label> <input type="text"
										class="form-control" onkeyup="chkNum(this)" name="fabricMeter"
										id="fabricMeter">
								</div>
								<div class="col-md-4">
									<label for="fabricIngredient">面料成分</label> <input type="text"
										class="form-control" name="fabricIngredient"
										id="fabricIngredient">
								</div>
								<div class="col-md-4">
									<label for="fabricOrigin">面料产地 </label> <input type="text"
										class="form-control" name="fabricOrigin"
										id="fabricOrigin" placeholder=" ">
								</div>

								<div class="col-md-4">
									<label for="fabricType">面料类型 </label> <input type="text"
										class="form-control" name="fabricType" id="fabricType"
										placeholder=" ">
								</div>
								<div class="col-md-4">

									<label for="file">面料图样 </label> <input type="file" name="file1"
										placeholder=" ">
								</div>
								<div class="col-md-4">
									<label for="colorCardUpdatedDate">色卡更新日期 </label> <input
										type="text" class="form-control  input-date"
										name="colorCardUpdatedDate" id="colorCardUpdatedDate"
										placeholder=" ">
								</div>
								<div class="col-md-4">
									<input hidden="hidden" type="text" class="form-control"
										name="id" id="findFabricLibraryById">
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">关闭</button>
							<button type="button" class="btn btn-primary"
								data-dismiss="modal" id="submit-btn">提交</button>
						</div>
					</form>

				</div>
				<!-- /.modal-content 
					$("#submit-btn").click(function() {
		var formData = new FormData($("#addOrUpdateFabricLibrary")[0]);
		$.ajax({
			url : 'addFabricLibrary.do',
			type : 'POST',
			data : formData,
			async : false,
			cache : false,
			contentType : false,
			processData : false,
			success : function(data) {

			}
		});
	});
				
				-->
			</div>
			<!-- /.modal -->
		</div>
		<!-- 刪除 -->
		<div class="modal fade" id="del_Modal" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"
							aria-hidden="true">&times;</button>
					</div>
					<div id="myModal-prompt" class="modal-body">
						你确定刪除面料: <span style="color: red" id="myModal-wave-text"> </span>
						的数据吗？？？
					</div>
					<input hidden="hidden" id="del-input-id" name="del-id" type="text">
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">
							取消</button>
						<button type="button" id="del-btn" class="btn btn-primary">
							确认刪除</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal -->
		</div>
	</div>
</body>
<script type="text/javascript" src="/res/js/input-date.js"></script>
<script type="text/javascript">
	var url = location.href;
	var argArr = [];
	if (url) {
		console.info(url)
		var argStr = url.split("?");
		if (argStr.length > 1) {
			var arg = argStr[1].split("&");
			for (var a = 0; a < arg.length; a++) {
				var temp = arg[a].split("=");
				argArr[temp[0]] = temp[1]
			}
		}
	}
	//赋值    //你要看
	for ( var a in argArr) {
		$("#input-supplierCode").val(argArr[a].substr(0, 4));
		$("#input-colorCardCode").val(argArr[a]);
	}
	$(function() {
		var Val = $("#form-anyVal").serialize();
		$.post('getFabricLibraryByPageCount.do', Val, function(data) {
			$("#pageSize").val(10);
			$("#pageNow").val(data.pageNow);
			var anyVal = $("#form-anyVal").serialize();
			findConditionFabricLibraryByPage(anyVal);
			$(".tcdPageCode").createPage({
				pageCount : data.totalPageCount,
				current : data.pageNow,
				backFn : function(p) {
					$("#pageSize").val(10);
					$("#pageNow").val(p);
					var anyVal = $("#form-anyVal").serialize();
					findConditionFabricLibraryByPage(anyVal);
				}
			});
		});
	});
	function delFabricLibraryById(id, name) {
		$("#del-input-id").val(id);
		$("#myModal-wave-text").text(name);
	};
	$("#del-btn").on('click', function() {
		var id = $("#del-input-id").val();
		alert("因为是面料档案 所以没有删除.请联系管理员 谢谢");

	});
	//点击查询获取查询的条件 数据
	$("#anyVal-btn").on('click', function() {
		$("#pageSize").attr('name', "");
		$("#pageNow").attr('name', "");
		var anyVal = $("#form-anyVal").serialize();
		$.post('getFabricLibraryByPageCount.do', anyVal, function(data) {
			$("#pageSize").attr('name', "pageSize");
			$("#pageNow").attr('name', "pageNow");
			$("#pageNow").val(1);
			var anyVal1 = $("#form-anyVal").serialize();
			findConditionFabricLibraryByPage(anyVal1);
			$(".tcdPageCode").createPage({
				pageCount : data.totalPageCount,
				current : data.pageNow,
				backFn : function(p) {
					$("#pageSize").val(10);
					$("#pageNow").val(p);
					var anyVal = $("#form-anyVal").serialize();
					findConditionFabricLibraryByPage(anyVal);
				}
			});
		});
	});

	//动态加载供应商
	$("#add_button_ColorCard").on(
			"click",
			function() {
				$.post('findFabricSupplierByAll.do', {}, function(data) {
					for (var i = 0; i < data.length; i++) {
						$("#selectlink").append(
								"<option value="+data[i].supplierCode+">"
										+ data[i].supplierName + "</option>");
					}

				});
			});

	//点击提交
	$("#submit-btn").on("click", function() {
		//var anyVal = $("#addOrUpdateFabricLibrary").serialize();
		var anyVal = new FormData($("#addOrUpdateFabricLibrary")[0]);
		var if_input_Id = $("#findFabricLibraryById").val();
		if (if_input_Id != "" && if_input_Id != null) {
			modifyFabricLibrary(anyVal);
		} else {
			addFabricLibrary(anyVal);
		}
	});
	//添加
	function addFabricLibrary(anyVal) {
		$.ajax({
			url : 'addFabricLibrary.do',
			type : 'POST',
			data : anyVal,
			async : false,
			cache : false,
			contentType : false,
			processData : false,
			success : function(data) {
				if (data == 18) {
					alert("你要添加的面料已经存在相同的数据了!!请对其修改!!");
				} else {
					window.location.reload();//刷新当前页面.
				}
			}
		});
	};
	//修改
	function modifyFabricLibrary(anyVal) {
		$.ajax({
			url : 'modifyFabricLibrary.do',
			type : 'POST',
			data : anyVal,
			async : false,
			cache : false,
			contentType : false,
			processData : false,
			success : function(data) {
				var pageNow = $("#pageNow").val();
				$("#pageSize").val(10);
				$("#pageNow").val(pageNow); //給當前頁賦值
				var anyVal = $("#form-anyVal").serialize(); //获取form表单
				//調用方法
				findConditionFabricLibraryByPage(anyVal);
			}
		});
	};
	$("#val-input-empty").find('div').find('div').find(":input").each(
			function() {
				$(this).val("");
			})
	function findConditionFabricLibraryByPage(anyVal) {
		$
				.post(
						"findConditionFabricLibraryByPage.do",
						anyVal,
						function(data) {
							$(".table_app").empty();
							for (var i = 0; i < data.length; i++) {
								var _HTML_TEBLE_ = "";
								_HTML_TEBLE_ = "<tr><td >"
										+ (data[i].fabricCode == null ? ''
												: data[i].fabricCode)
										+ "</td><td >"
										+ (data[i].supplierName == null ? ''
												: data[i].supplierName)
										+ "</td><td >"
										+ (data[i].colorCardNmae == null ? ''
												: data[i].colorCardNmae)
										+ "</td><td >"
										+ (data[i].colorCode == null ? ''
												: data[i].colorCode)
										+ "</td><td >"
										+ (data[i].colorName == null ? ''
												: data[i].colorName)
										+ "</td><td >"
										+ (data[i].fabricPrice == null ? ''
												: data[i].fabricPrice)
										+ "</td><td >"
										+ (data[i].fabricLength == null ? ''
												: data[i].fabricLength)
										+ "</td><td >"
										+ (data[i].fabricMeter == null ? ''
												: data[i].fabricMeter)
										+ "</td><td >"
										+ (data[i].fabricOrigin == null ? ''
												: data[i].fabricOrigin)
										+ "</td><td >"
										+ (data[i].fabricIngredient == null ? ''
												: data[i].fabricIngredient)
										+ "</td><td >"
										+ (data[i].gramWeight == null ? ''
												: data[i].gramWeight)
										+ "</td><td >"
										+ (data[i].kilogramMeter == null ? ''
												: data[i].kilogramMeter)
										+ "</td><td >"
										+ (data[i].fabricType == null ? ''
												: data[i].fabricType)
										+ "</td><td ><img src='"
										+ (data[i].fabricSample == null ? ''
												: data[i].fabricSample)
										+ "' height='100' width='100'/></td><td >"
										+ (data[i].colorCardUpdatedDate == null ? ''
												: data[i].colorCardUpdatedDate)
										+ "</td><td >"
										+ (data[i].createTime == null ? ''
												: data[i].createTime)
										+ "</td><td ><button type='button'  data-toggle='modal' data-target='#myModal'  onclick='findFabricLibraryById(\""
										+ data[i].id
										+ "\")'  class='btn btn-primary icon-pencil'>修改</button><button type='button'  data-toggle='modal' data-target='#del_Modal' onclick='delFabricLibraryById(\""
										+ data[i].id
										+ "\",\""
										+ data[i].fabricName
										+ "\")' class='icon-trash btn btn-danger'>删除</button></td></tr>";
								$(".table_app").append(_HTML_TEBLE_);
							}
						});
	};
	//根据id获取当前数据
	function findFabricLibraryById(id) {
		$.post("findFabricLibraryById.do", {
			'id' : id
		}, function(result) {
			$("#findFabricLibraryById").val(result.id);
			$("#fabricName").val(result.fabricName);
			$("#supplierCode").val(result.supplierCode);
			$("#supplierName").val(result.supplierName);
			$("#fabricLength").val(result.fabricLength);
			$("#colorCardCode").val(result.colorCardCode);
			$("#colorCardNmae").val(result.colorCardNmae);
			$("#colorCode").val(result.colorCode);
			$("#colorName").val(result.colorName);
			$("#fabricPrice").val(result.fabricPrice);
			$("#fabricLength").val(result.fabricLength);
			$("#fabricMeter").val(result.fabricMeter);
			$("#fabricOrigin").val(result.fabricOrigin);
			$("#fabricIngredient").val(result.fabricIngredient);
			$("#fabricGrammage").val(result.fabricGrammage);
			$("#fabricType").val(result.fabricType);
			$("#fabricSample").val(result.fabricSample);
			$("#colorCardUpdatedDate").val(result.colorCardUpdatedDate);
		});
		//禁止修改编号
		$("#colorCode").attr("readonly", true);
	};//点击添加添加清空id
	$("#add_button").on("click", function() {
		$("#selectlink-supplier").find("option").remove();
		for ( var a in argArr) {
			var supplierCode = argArr[a];
		}
		$("#supplierCode").val(argArr[a].substr(0, 4));
		$("#colorCardCode").val(argArr[a]);
		$("#colorCode").attr("readonly", false);
		$("#findFabricLibraryById").val("");
	});
	$(".field").change(function() {
		$(this).css("background-color", "#FFFFCC");
	});
	$(".colorLength").blur(function() {
		var length = $(this).val().length;
		if (length != 3) {
			$("#submit-btn").hide();
			alert("你输入的格式不正确:如:001");
		} else {
			$("#submit-btn").show();
		}
	})
</script>
</html>