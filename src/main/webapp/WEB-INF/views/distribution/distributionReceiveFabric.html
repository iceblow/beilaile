<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>经销领面料</title><@p.cache/> <@p.css/><@p.js/>
<script type="text/javascript" src="/res/js/input-date.js"></script>
</head>
<body>
	<@p.top/>
    <div class="main-container" id="main-container">
            <script type="text/javascript">try {ace.settings.check('main-container', 'fixed') } catch(e) {} </script>
            <div class="main-container-inner">
                <@p.left/>
                <div class="main-content">
                    <div class="breadcrumbs" id="breadcrumbs">
                        <script type="text/javascript">try {ace.settings.check('breadcrumbs', 'fixed')} catch(e) {}</script>
                        <ul class="breadcrumb">
                            <li>
                                <i class="icon-home home-icon"></i>
                                <a href="#">Home</a></li>
                            <li>
                                <a href="#">Tables</a></li>
                            <li class="active">经销领面料</li></ul>
                        <div class="nav-search" id="nav-search"></div>
                     </div>
                   <!--  <div class="col-md-12">
                        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">添加</button></div> -->
                    <div class="col-md-12">
                        <form action="" id="anyVal-from">
                            <div id="val-input-empty" class="col-md-8">
                                <div class="col-lg-4">
                                    <div class="input-group">
                                        <span class="input-group-addon">发出日期</span>
                                        <input name="issueDate" type="text" class="form-control">
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="input-group">
                                        <span class="input-group-addon">波次号</span>
                                        <input name="wave" type="text" class="form-control">
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="input-group">
                                        <span class="input-group-addon">面料材质</span>
                                        <input name="fabricMaterial" type="text" class="form-control">
                                    </div>
                                </div>
                                <div class="col-lg-4">
								<div class="input-group">
									<span class="input-group-addon">公司名称</span> 
									<input name="companyName" type="text" class="form-control">
								</div>
							</div>
                                <div class="col-lg-4">
                                    <div class="input-group">
                                        <span class="input-group-addon">面料单位</span>
                                        <input name="kgM" type="text" class="form-control">
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="input-group">
                                        <span class="input-group-addon">备注</span>
                                        <input name="remarks" value="" type="text" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <span class="input-group-btn">
                                    <button id="anyVal-btn" class="btn btn-default" type="button">查询</button>
                               	</span>
                            </div>
                            <div>
                                <input hidden="hidden" type="text" id="pageNow" name="pageNow" value="">
                                <input hidden="hidden" type="text" id="pageSize" name="pageSize" value=""></div>
                        </form>
                    </div>
                    
                    <!-- <div class="col-md-12" style="height: 50px;"></div> -->
                    <div class="page-content">
                        <div class="col-xs-12">
                            <div class="tabbable">
                                <table class="table table-bordered">
                                    <thead>
                                    	<tr>
                                    		<th colspan="40" style="text-align : center; font-size : 25px">经销领面料</th>
                                    	</tr>
                                        <tr>
                                            <th>序号</th>
                                            <th>公司名称</th>
                                            <th>发放日期</th>
                                            <th>波次号</th>
                                            <th>设计图</th>
                                            <th>面料材质</th>
                                            <th>面料1</th>
                                            <th>面料2</th>
                                            <th>面料3</th>
                                            <th>面料4</th>
                                            <th>面料5</th>
                                            <th>面料6</th>
                                            <th>面料7</th>
                                            <th>面料8</th>
                                            <th>面料9</th>
                                            <th>面料10</th>
                                            <th>面料11</th>
                                            <th>面料12</th>
                                            <th>面料13</th>
                                            <th>面料14</th>
                                            <th>面料15</th>
                                            <th>面料16</th>
                                            <th>面料17</th>
                                            <th>面料18</th>
                                            <th>面料19</th>
                                            <th>面料20</th>
                                            <th>单位</th>
                                            <th>总条数</th>
                                            <th>备注</th>
                                            <th>添加时间</th>
                                            <th>数据操作</th></tr>
                                    </thead>
                                    <tbody class="table_app"></tbody>
                                </table>
                                <ul class="pager pagination-lg tcdPageCode"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <!--修改 模态框（Modal） -->
            <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="myModalLabel">修改</h4></div>
                        <form enctype="multipart/form-data" role="form" id="modifyByDistribution" action="" method="post">
                            <div class="modal-body">
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <label for="issueDate">发出日期</label>
                                        <input type="text" class="form-control input-date" name="issueDate" id="issueDate" placeholder=" "></div>
                                    <div class="col-md-4">
                                        <label for="wave">波次号</label>
                                        <input type="text" class="form-control" name="wave" id="wave" placeholder=" "></div>
                                    <div class="col-md-4">
                                        <label for="fabricMaterial">面料材质</label>
                                        <input type="text" class="form-control" name="fabricMaterial" id="fabricMaterial"></div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <label for="companyName">公司名称</label>
                                        <input type="text" class="form-control" name="companyName" id="companyName" placeholder=""></div>
                                    <div id="modifyAddDiv"></div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <label class="control-label bolder blue">面料单位</label>
                                        <div class="radio">
                                            <label>
                                                <input name="kgM" type="radio" class="" value="KG" id="radio_kg_input">
                                                <span class="lbl">KG</span></label>
                                        </div>
                                        <div class="radio">
                                            <label>
                                                <input name="kgM" type="radio" class="" value="M" id="radio_m_input">
                                                <span class="lbl">M</span></label>
                                        </div>
                                        <div class="radio">
                                            <label>
                                                <input name="kgM" type="radio" class="" value="码" id="radio_code_input">
                                                <span class="lbl">码</span></label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="remarks">备注</label>
                                        <input type="text" class="form-control" name="remarks" id="remarks" placeholder=""></div>
                                </div>
                                <input hidden="hidden" id="distributionReceiveFabricId" type="text" value="" name="id"></div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="delDvi()">关闭</button>
                                <button type="button" onclick="modifyDistributionReceiveFabric_btn()" class="btn btn-primary" data-dismiss="modal">提交</button></div>
                        </form>
                    </div>
 				<!-- 刪除 -->
		<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div id="myModal-prompt" class="modal-body">
						你确定刪除波次号为: <span style="color: red" id="myModal2-wave-text">
						</span> 的数据嗎？？？
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">
							取消</button>
						<button type="button" id="del-btn2" class="btn btn-primary">
							確認刪除</button>
					</div>
				</div>
			</div>
		</div>
		<a href="#" id="btn-scroll-up"class="btn-scroll-up btn btn-sm btn-inverse"> 
			<i class="icon-double-angle-up icon-only bigger-110"> </i>
		</a> 
		<input type="hidden" value="${pageContext.request.contextPath}"id="path">
	</div>
    </body>

<script type="text/javascript">
	
	function delByDistributionFabric(id) {
		if(confirm("确认删除吗???")){
			$.ajax({
				url:'delDistributionReceiveFabric.do',
				type:'post',
				data:{'id' : id },
				dataType:'json',
				success:function(data){
					if (data = 1) {
						$("#myModal-prompt").html("恭喜你刪除成功");
						$("#del-btn2").remove();
						var anyVal = $("#anyVal-from").serialize(); //获取form表单
						//調用方法
						findDistributionReceiveFabricPageByVal(anyVal); //調用分頁查詢 在這裏才調用
					} else {
						$("#myModal-prompt").html("删除失败！原因可能是网络问题");
						$("#del-btn2").remove();
						var anyVal = $("#anyVal-from").serialize(); //获取form表单
						//調用方法
						findDistributionReceiveFabricPageByVal(anyVal); //調用分頁查詢 在這裏才調用
					}
				}
			});
		}
		  
	}

	//点击查询获取查询的条件 数据
	$(function() {
		$("#anyVal-btn").on('click',function() { //点击事查詢事件
			$("#pageSize").attr('name', ""); 	 //去掉分页查询pageSize
			$("#pageNow").attr('name', ""); 	 //去掉分页查询pageNow
			var anyVal = $("#anyVal-from").serialize(); //獲取條件查詢字段
			$.post('getDistributionReceiveFabricByPageCount.do',anyVal,function(data) { //帶條件查詢縂條數
				$("#pageSize").attr('name',"pageSize"); //给pageSize赋值name
				$("#pageNow").attr('name',"pageNow"); //给pageNow赋name值
				$("#pageNow").val(1);
				var anyVal = $("#anyVal-from").serialize(); //獲取條件字段
				findDistributionReceiveFabricPageByVal(anyVal);
				$(".tcdPageCode").createPage({
					pageCount : data.totalPageCount,
					current : data.pageNow,
					backFn : function(p) {
					$("#pageSize").val(10);
					$("#pageNow").val(p); //給當前頁賦值
					var anyVal = $("#anyVal-from").serialize(); //获取form表单
					//調用方法
					findDistributionReceiveFabricPageByVal(anyVal); //調用分頁查詢 在這裏才調用
			}
			});
		});
	});
		//修改赋值方法 
		$("#up").uploadPreview({
			Img : "ImgPr",
			Width : 120,
			Height : 120
		});
	});
	
		//修改方法
	function modifyDistributionReceiveFabric_btn() {
		var formData = new FormData($("#modifyByDistribution")[0]);
		$.ajax({
			url : 'modifyDistributionReceiveFabric.do',
			type : 'POST',
			data : formData,
			async : false,
			cache : false,
			contentType : false,
			processData : false,
			success : function(data) {
				var pageNow = $("#pageNow").val();
				$("#pageSize").val(10);
				$("#pageNow").val(pageNow); //給當前頁賦值
				var anyVal = $("#anyVal-from").serialize(); //获取form表单
				//調用方法
				findDistributionReceiveFabricPageByVal(anyVal);
			},
			error : function(data) {
				$("#pageSize").val(10);
				$("#pageNow").val(1); //給當前頁賦值
				var anyVal = $("#anyVal-from").serialize(); //获取form表单
				//調用方法
				findDistributionReceiveFabricPageByVal(anyVal);
			}
		});
	}
	/*页面加载执行的方法*/
	$.post('getDistributionReceiveFabricByPageCount.do', {}, function(data) {
		$("#pageSize").val(10); 
		$("#pageNow").val(data.pageNow);
		//获取form参数进行查询
		var anyVal = $("#anyVal-from").serialize();
		//調用方法传参
		findDistributionReceiveFabricPageByVal(anyVal);
		// 进入后台进行分页查询
		$(".tcdPageCode").createPage({ 
			pageCount : data.totalPageCount,
			//总页数
			current : data.pageNow,
			//当前页
			backFn : function(p) {
				$("#pageSize").val(10);
				$("#pageNow").val(p); //給當前頁賦值
				var anyVal = $("#anyVal-from").serialize(); //获取form表单
				//調用方法
				findDistributionReceiveFabricPageByVal(anyVal);
			}
		});
	});
	$("#val-input-empty").find('div').find('div').find(":input").each(
			function() {
				$(this).val("");
			})
	//查詢方法
	function findDistributionReceiveFabricPageByVal(anyVal) { 				//你的数据都是从这里查的？
		$.post("findConditionDistributionReceiveFabricByPage.do",anyVal, function(data) {
			var id = 1;
			$(".table_app").empty(); //清空原有的数据
			for (var i = 0; i < data.length; i++) {
			var _HTML_TEBLE_ = "";
			_HTML_TEBLE_ = "<tr><td >"
				+ data[i].id
				+ "</td><td >"
				+ (data[i].companyName == null ? '' : data[i].companyName)
					+ "</td><td >"
					+ (data[i].issueDate = null ? '' : data[i].issueDate)
					+ "</td><td >"
					+ (data[i].wave == null ? '' : data[i].wave)
					+ "</td><td><img style='width: 80px; height: 80px' src=" + data[i].designImg + "></td><td >"
					+ (data[i].fabricMaterial == null ? '' : data[i].fabricMaterial)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter1 == null ? '' : data[i].parameter1)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter2 == null ? '' : data[i].parameter2)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter3 == null ? '' : data[i].parameter3)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter4 == null ? '' : data[i].parameter4)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter5 == null ? ''	: data[i].parameter5)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter6 == null ? '' : data[i].parameter6)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter7 == null ? '' : data[i].parameter7)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter8 == null ? '' : data[i].parameter8)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter9 == null ? '' : data[i].parameter9)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter10 == null ? '' : data[i].parameter10)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter11 == null ? '' : data[i].parameter11)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter12 == null ? '' : data[i].parameter12)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter13 == null ? '' : data[i].parameter13)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter14 == null ? '' : data[i].parameter14)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter15 == null ? '' : data[i].parameter15)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter16 == null ? '' : data[i].parameter16)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter17 == null ? '' : data[i].parameter17)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter18 == null ? '' : data[i].parameter18)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter19 == null ? '': data[i].parameter19)
					+ "</td><td class='parameter' >"
					+ (data[i].parameter20 == null ? '' : data[i].parameter20)
					+ "</td><td >"
					+ (data[i].kgM == null ? '' : data[i].kgM)
					+ "</td><td >"
					+ (data[i].totalCount == null ? '' : data[i].totalCount)
					+ "</td><td>"
					+ (data[i].remarks == null ? '' : data[i].remarks)
					+ "</td><td>"
					+ (data[i].addTime == null ? '': data[i].addTime)
					+ "</td><td class='fulfilStatus"+data[i].id+"' ><button type='button'  data-toggle='modal' data-target='#myModal1' onclick='modifyDistributionReceiveFabric(\""
					+ data[i].id
					+ "\",this)' class='btn btn-primary icon-pencil'>点击修改</button><button type='button'   onclick='delByDistributionFabric(\""
					+ data[i].id
					+ "\")' class='btn btn-danger icon-pencil'>确定删除</button></td></tr>";
					$(".table_app").append(_HTML_TEBLE_);
			}
		});
	}
	
	//点击修改弹出模态框
	function modifyDistributionReceiveFabric(id, tr) {
		$(tr).parent().parent().find(".parameter").each(function(){
			if ($(this).html() != "" && $(this).html() != null) {
				var a = $("#modifyAddDiv").find("input");
				if(a.length<20){
					$("#modifyAddDiv").append(
						"<div class='col-md-4'><label for='parameter'>面料"
							+ (a.length + 1)
							+ " </label><input type='text' onkeyup='value=value.replace(/[^\\d.]/g,&#39;&#39;)' class='form-control' name='parameter"
							+ (a.length + 1)
							+ "' id='parameter"
							+ (a.length + 1)
							+ "'></div>");
				}else{
					return false;
				}
				
			}
		});
		//修改获取最新数据
		$.post("getDistributionReceiveFabricById.do", {
			'id' : id
		}, function(result) {
			$("#distributionReceiveFabricId").val(id);
			var Company = result.kgM;
			if (Company == 'KG') {
				$("#radio_code_input").removeAttr('checked');
				$("#radio_m_input").removeAttr('checked');
				$("#radio_kg_input").prop('checked', "checked");
			} else if (Company == 'M') {
				$("#radio_kg_input").removeAttr('checked');
				$("#radio_code_input").removeAttr('checked');
				$("#radio_m_input").prop('checked', "checked");
			} else if (Company == '码') {
				$("#radio_kg_input").removeAttr('checked');
				$("#radio_m_input").removeAttr('checked');
				$("#radio_code_input").prop('checked', "checked");
			}
			$("#companyName").val(result.companyName);//这些可以 正常回去表格的数据的 
			$("#issueDate").val(result.issueDate);
			$("#wave").val(result.wave);
			$("#fabricMaterial").val(result.fabricMaterial);
			$("#parameter1").val(result.parameter1);
			$("#parameter2").val(result.parameter2);
			$("#parameter3").val(result.parameter3);
			$("#parameter4").val(result.parameter4);
			$("#parameter5").val(result.parameter5);
			$("#parameter6").val(result.parameter6);
			$("#parameter7").val(result.parameter7);
			$("#parameter8").val(result.parameter8);
			$("#parameter9").val(result.parameter9);
			$("#parameter10").val(result.parameter10);
			$("#parameter11").val(result.parameter11);
			$("#parameter12").val(result.parameter12);
			$("#parameter13").val(result.parameter13);
			$("#parameter14").val(result.parameter14);
			$("#parameter15").val(result.parameter15);
			$("#parameter16").val(result.parameter16);
			$("#parameter17").val(result.parameter17);
			$("#parameter18").val(result.parameter18);
			$("#parameter19").val(result.parameter19);
			$("#parameter20").val(result.parameter20);
			$("#remarks").val(result.remarks);
		});
	};
	$("#myselect").click(function() {
		$("#mydiv").show();
	});
</script>
</html>